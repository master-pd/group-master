name: Minimal Telegram Bot

on:
  workflow_dispatch:
  schedule:
    - cron: '*/25 * * * *'  # à¦ªà§à¦°à¦¤à¦¿ à§¨à§« à¦®à¦¿à¦¨à¦¿à¦Ÿà§‡

jobs:
  run:
    runs-on: ubuntu-latest
    timeout-minutes: 24
    
    steps:
    - name: Checkout
      uses: actions/checkout@v4
      
    - name: Generate lock file
      run: |
        # Quick package.json
        echo '{
          "name": "telegram-bot",
          "version": "1.0.0",
          "dependencies": {
            "node-telegram-bot-api": "^0.64.0"
          }
        }' > package.json
        
        npm install
        
    - name: Create and run bot
      env:
        BOT_TOKEN: ${{ secrets.BOT_TOKEN }}
      run: |
        # Minimal bot code
        cat > bot.js << 'EOF'
        const TelegramBot = require('node-telegram-bot-api');
        const token = process.env.BOT_TOKEN;
        const bot = new TelegramBot(token, { polling: true });
        
        console.log('ðŸ¤– Bot started on GitHub Actions');
        
        bot.onText(/\/start/, (msg) => {
          bot.sendMessage(msg.chat.id, 
            'ðŸš€ Bot is running on GitHub Actions!\n' +
            'â° Uptime: 24/7 (auto-restart)\n' +
            'ðŸ’¾ Memory: ' + Math.round(process.memoryUsage().heapUsed / 1024 / 1024) + 'MB'
          );
        });
        
        bot.on('message', (msg) => {
          if (msg.text === 'ping') {
            bot.sendMessage(msg.chat.id, 'ðŸ“ pong');
          }
        });
        
        // Keep alive
        setInterval(() => {
          console.log('ðŸ«€ Heartbeat:', new Date().toISOString());
        }, 60000);
        EOF
        
        # Run for 23 minutes
        timeout 23m node bot.js
